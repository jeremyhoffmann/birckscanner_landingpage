// Translations
const translations = {
  fr: {
    howItWorks: "Comment √ßa marche",
    download: "T√©l√©charger",
    heroTitle: "Scannez vos LEGO,<br><span class='gradient-text'>construisez vos r√™ves</span>",
    heroSubtitle: "Photographiez vos pi√®ces LEGO et d√©couvrez instantan√©ment tous les sets que vous pouvez construire avec notre IA de reconnaissance intelligente.",
    downloadOn: "T√©l√©charger sur",
    getItOn: "Disponible sur",
    statDownloads: "T√©l√©chargements",
    statAccuracy: "Pr√©cision",
    statSets: "Sets d√©tect√©s",
    howItWorksTitle: "Comment √ßa marche",
    howItWorksSubtitle: "Trois √©tapes simples pour d√©couvrir ce que vous pouvez construire",
    step1Title: "1. Photographiez",
    step1Desc: "Prenez une photo de vos pi√®ces LEGO √©parpill√©es sur une surface claire",
    step2Title: "2. IA analyse",
    step2Desc: "Notre intelligence artificielle identifie et classe chaque pi√®ce en quelques secondes",
    step3Title: "3. Construisez",
    step3Desc: "D√©couvrez tous les sets possibles et suivez les instructions de montage",
    featuresTitle: "Pourquoi choisir Brick Scanner ?",
    feature1Title: "Reconnaissance pr√©cise",
    feature1Desc: "99% de pr√©cision dans l'identification des pi√®ces LEGO gr√¢ce √† notre IA avanc√©e",
    feature2Title: "Base de donn√©es compl√®te",
    feature2Desc: "Plus de 10 000 sets LEGO r√©f√©renc√©s avec instructions d√©taill√©es",
    feature3Title: "Interface intuitive",
    feature3Desc: "Application simple et √©l√©gante, con√ßue pour tous les √¢ges",
    feature4Title: "R√©sultats instantan√©s",
    feature4Desc: "Analyses en temps r√©el, r√©sultats en moins de 3 secondes",
    testimonialsTitle: "Ce que disent nos utilisateurs",
    testimonial1: "\"Incroyable ! J'ai red√©couvert mes vieux LEGO gr√¢ce √† cette app. Mes enfants sont ravis de construire de nouveaux sets.\"",
    testimonial1Role: "Maman de 2 enfants",
    testimonial2: "\"La reconnaissance est bluffante ! M√™me avec des pi√®ces m√©lang√©es de diff√©rentes couleurs, l'app trouve toujours des constructions possibles.\"",
    testimonial2Role: "Collectionneur LEGO",
    testimonial3: "\"Parfait pour organiser ma collection LEGO ! La reconnaissance IA est incroyablement pr√©cise et rapide.\"",
    testimonial3Role: "Passionn√© LEGO",
    ctaTitle: "Pr√™t √† red√©couvrir vos LEGO ?",
    ctaSubtitle: "T√©l√©chargez Brick Scanner d√®s maintenant et commencez votre aventure",
    footerDesc: "L'application qui r√©volutionne votre exp√©rience LEGO",
    footerContactTitle: "Contact",
    footerLegalTitle: "L√©gal",
    footerPrivacy: "Politique de confidentialit√©",
    footerRights: "Tous droits r√©serv√©s.",
    footerDisclaimer: "LEGO¬Æ est une marque d√©pos√©e du groupe LEGO. Cette application n'est pas affili√©e √† LEGO.",
    modalTitle: "Comment fonctionne Brick Scanner",
    modalStep1: "Photographiez vos pi√®ces",
    modalStep1Desc: "Disposez vos pi√®ces LEGO sur une surface claire et prenez une photo avec votre smartphone",
    modalStep2: "Analyse IA instantan√©e",
    modalStep2Desc: "Notre intelligence artificielle avanc√©e analyse et identifie chaque pi√®ce en temps r√©el",
    modalStep3: "D√©couvrez les possibilit√©s",
    modalStep3Desc: "Explorez tous les sets que vous pouvez construire avec des instructions d√©taill√©es"
  },
  en: {
    howItWorks: "How it Works",
    download: "Download",
    heroTitle: "Scan your LEGO,<br><span class='gradient-text'>build your dreams</span>",
    heroSubtitle: "Photograph your LEGO pieces and instantly discover all the sets you can build with our intelligent AI recognition.",
    downloadOn: "Download on the",
    getItOn: "Get it on",
    statDownloads: "Downloads",
    statAccuracy: "Accuracy",
    statSets: "Sets detected",
    howItWorksTitle: "How it Works",
    howItWorksSubtitle: "Three simple steps to discover what you can build",
    step1Title: "1. Photograph",
    step1Desc: "Take a photo of your LEGO pieces scattered on a clear surface",
    step2Title: "2. AI analyzes",
    step2Desc: "Our artificial intelligence identifies and classifies each piece in seconds",
    step3Title: "3. Build",
    step3Desc: "Discover all possible sets and follow the building instructions",
    featuresTitle: "Why choose Brick Scanner?",
    feature1Title: "Precise recognition",
    feature1Desc: "99% accuracy in LEGO piece identification thanks to our advanced AI",
    feature2Title: "Complete database",
    feature2Desc: "Over 10,000 LEGO sets referenced with detailed instructions",
    feature3Title: "Intuitive interface",
    feature3Desc: "Simple and elegant app, designed for all ages",
    feature4Title: "Instant results",
    feature4Desc: "Real-time analysis, results in less than 3 seconds",
    testimonialsTitle: "What our users say",
    testimonial1: "\"Amazing! I rediscovered my old LEGO thanks to this app. My kids love building new sets.\"",
    testimonial1Role: "Mom of 2 children",
    testimonial2: "\"The recognition is mind-blowing! Even with mixed pieces of different colors, the app always finds possible constructions.\"",
    testimonial2Role: "LEGO Collector",
    testimonial3: "\"Perfect for organizing my LEGO collection! The AI recognition is incredibly accurate and fast.\"",
    testimonial3Role: "LEGO Enthusiast",
    ctaTitle: "Ready to rediscover your LEGO?",
    ctaSubtitle: "Download Brick Scanner now and start your adventure",
    footerDesc: "The app that revolutionizes your LEGO experience",
    footerContactTitle: "Contact",
    footerLegalTitle: "Legal",
    footerPrivacy: "Privacy Policy",
    footerRights: "All rights reserved.",
    footerDisclaimer: "LEGO¬Æ is a trademark of the LEGO Group. This app is not affiliated with LEGO.",
    modalTitle: "How Brick Scanner Works",
    modalStep1: "Photograph your pieces",
    modalStep1Desc: "Arrange your LEGO pieces on a clear surface and take a photo with your smartphone",
    modalStep2: "Instant AI analysis",
    modalStep2Desc: "Our advanced artificial intelligence analyzes and identifies each piece in real-time",
    modalStep3: "Discover possibilities",
    modalStep3Desc: "Explore all the sets you can build with detailed instructions"
  },
  es: {
    howItWorks: "C√≥mo funciona",
    download: "Descargar",
    heroTitle: "Escanea tus LEGO,<br><span class='gradient-text'>construye tus sue√±os</span>",
    heroSubtitle: "Fotograf√≠a tus piezas LEGO y descubre instant√°neamente todos los sets que puedes construir con nuestra IA de reconocimiento inteligente.",
    downloadOn: "Descargar en",
    getItOn: "Disponible en",
    statDownloads: "Descargas",
    statAccuracy: "Precisi√≥n",
    statSets: "Sets detectados",
    howItWorksTitle: "C√≥mo funciona",
    howItWorksSubtitle: "Tres pasos simples para descubrir qu√© puedes construir",
    step1Title: "1. Fotograf√≠a",
    step1Desc: "Toma una foto de tus piezas LEGO esparcidas en una superficie clara",
    step2Title: "2. IA analiza",
    step2Desc: "Nuestra inteligencia artificial identifica y clasifica cada pieza en segundos",
    step3Title: "3. Construye",
    step3Desc: "Descubre todos los sets posibles y sigue las instrucciones de construcci√≥n",
    featuresTitle: "¬øPor qu√© elegir Brick Scanner?",
    feature1Title: "Reconocimiento preciso",
    feature1Desc: "99% de precisi√≥n en la identificaci√≥n de piezas LEGO gracias a nuestra IA avanzada",
    feature2Title: "Base de datos completa",
    feature2Desc: "M√°s de 10,000 sets LEGO referenciados con instrucciones detalladas",
    feature3Title: "Interfaz intuitiva",
    feature3Desc: "Aplicaci√≥n simple y elegante, dise√±ada para todas las edades",
    feature4Title: "Resultados instant√°neos",
    feature4Desc: "An√°lisis en tiempo real, resultados en menos de 3 segundos",
    testimonialsTitle: "Lo que dicen nuestros usuarios",
    testimonial1: "\"¬°Incre√≠ble! Redescubr√≠ mis viejos LEGO gracias a esta app. Mis hijos est√°n encantados de construir nuevos sets.\"",
    testimonial1Role: "Mam√° de 2 ni√±os",
    testimonial2: "\"¬°El reconocimiento es impresionante! Incluso con piezas mezcladas de diferentes colores, la app siempre encuentra construcciones posibles.\"",
    testimonial2Role: "Coleccionista LEGO",
    testimonial3: "\"¬°Perfecto para organizar mi colecci√≥n LEGO! El reconocimiento IA es incre√≠blemente preciso y r√°pido.\"",
    testimonial3Role: "Entusiasta LEGO",
    ctaTitle: "¬øListo para redescubrir tus LEGO?",
    ctaSubtitle: "Descarga Brick Scanner ahora y comienza tu aventura",
    footerDesc: "La aplicaci√≥n que revoluciona tu experiencia LEGO",
    footerContactTitle: "Contacto",
    footerLegalTitle: "Legal",
    footerPrivacy: "Pol√≠tica de Privacidad",
    footerRights: "Todos los derechos reservados.",
    footerDisclaimer: "LEGO¬Æ es una marca registrada del Grupo LEGO. Esta aplicaci√≥n no est√° afiliada a LEGO.",
    modalTitle: "C√≥mo funciona Brick Scanner",
    modalStep1: "Fotograf√≠a tus piezas",
    modalStep1Desc: "Coloca tus piezas LEGO en una superficie clara y toma una foto con tu smartphone",
    modalStep2: "An√°lisis IA instant√°neo",
    modalStep2Desc: "Nuestra inteligencia artificial avanzada analiza e identifica cada pieza en tiempo real",
    modalStep3: "Descubre posibilidades",
    modalStep3Desc: "Explora todos los sets que puedes construir con instrucciones detalladas"
  }
};

// DOM Elements
const languageSelect = document.getElementById('languageSelect');
const hamburger = document.querySelector('.hamburger');
const navMenu = document.querySelector('.nav-menu');
const howItWorksBtn = document.querySelector('.how-it-works-btn');
const modal = document.getElementById('howItWorksModal');
const closeModal = document.querySelector('.close');
const appScreenshot = document.getElementById('appScreenshot');

// Current language
let currentLanguage = 'fr';

// Initialize app
document.addEventListener('DOMContentLoaded', function() {
  // Set default language
  updateLanguage(currentLanguage);
  
  // Smooth scrolling for navigation
  setupSmoothScrolling();
  
  // Navbar scroll effect
  setupNavbarScrollEffect();
  
  // Intersection Observer for animations
  setupScrollAnimations();
  
  // Set up app screenshot placeholder
  setupAppScreenshot();
  
  // Set up avatar placeholders
  setupAvatarPlaceholders();
});

// Language switching
languageSelect.addEventListener('change', function() {
  currentLanguage = this.value;
  updateLanguage(currentLanguage);
  document.documentElement.lang = currentLanguage;
});

function updateLanguage(lang) {
  const elements = document.querySelectorAll('[data-translate]');
  elements.forEach(element => {
    const key = element.getAttribute('data-translate');
    if (translations[lang] && translations[lang][key]) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = translations[lang][key];
      } else {
        element.innerHTML = translations[lang][key];
      }
    }
  });
}

// Mobile menu toggle
hamburger.addEventListener('click', function() {
  navMenu.classList.toggle('active');
  hamburger.classList.toggle('active');
});

// Close mobile menu when clicking on links
document.querySelectorAll('.nav-menu a, .nav-menu button').forEach(link => {
  link.addEventListener('click', () => {
    navMenu.classList.remove('active');
    hamburger.classList.remove('active');
  });
});

// Modal functionality
howItWorksBtn.addEventListener('click', function() {
  modal.style.display = 'block';
  document.body.style.overflow = 'hidden';
});

closeModal.addEventListener('click', function() {
  modal.style.display = 'none';
  document.body.style.overflow = 'auto';
});

window.addEventListener('click', function(event) {
  if (event.target === modal) {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
  }
});

// Smooth scrolling
function setupSmoothScrolling() {
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    });
  });
}

// Navbar scroll effect
function setupNavbarScrollEffect() {
  const navbar = document.querySelector('.navbar');
  let lastScrollY = window.scrollY;

  window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;
    
    if (currentScrollY > 100) {
      navbar.style.background = 'rgba(255, 255, 255, 0.98)';
      navbar.style.backdropFilter = 'blur(10px)';
      navbar.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.1)';
    } else {
      navbar.style.background = 'rgba(255, 255, 255, 0.95)';
      navbar.style.backdropFilter = 'blur(10px)';
      navbar.style.boxShadow = 'none';
    }
    
    // Hide/show navbar on scroll
    if (currentScrollY > lastScrollY && currentScrollY > 200) {
      navbar.style.transform = 'translateY(-100%)';
    } else {
      navbar.style.transform = 'translateY(0)';
    }
    
    lastScrollY = currentScrollY;
  });
}

// Scroll animations
function setupScrollAnimations() {
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('fade-in-up');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // Observe elements for animation
  const animatedElements = document.querySelectorAll(
    '.step, .feature, .testimonial, .hero-content, .section-title'
  );
  
  animatedElements.forEach(el => {
    observer.observe(el);
  });
}

// App screenshot setup
function setupAppScreenshot() {
  // Create a gradient placeholder for the app screenshot
  const canvas = document.createElement('canvas');
  canvas.width = 240;
  canvas.height = 520;
  const ctx = canvas.getContext('2d');
  
  // Create gradient background
  const gradient = ctx.createLinearGradient(0, 0, 0, 520);
  gradient.addColorStop(0, '#dc2626');
  gradient.addColorStop(1, '#ef4444');
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, 240, 520);
  
  // Add some UI elements
  ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
  ctx.fillRect(20, 80, 200, 60);
  ctx.fillRect(20, 160, 200, 120);
  ctx.fillRect(20, 300, 90, 90);
  ctx.fillRect(130, 300, 90, 90);
  
  // Add LEGO brick icons
  ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
  ctx.font = '24px sans-serif';
  ctx.fillText('üü•', 40, 340);
  ctx.fillText('üü¶', 150, 340);
  ctx.fillText('üü®', 40, 370);
  ctx.fillText('üü©', 150, 370);
  
  // Convert to data URL and set as src
  appScreenshot.src = canvas.toDataURL();
  appScreenshot.alt = 'Brick Scanner App Interface';
}

// Avatar placeholders setup
function setupAvatarPlaceholders() {
  const avatars = document.querySelectorAll('.testimonial-author img');
  avatars.forEach((avatar, index) => {
    const canvas = document.createElement('canvas');
    canvas.width = 100;
    canvas.height = 100;
    const ctx = canvas.getContext('2d');
    
    // Create circular avatar with initials
    const colors = ['#dc2626', '#b91c1c', '#f87171'];
    const initials = [['M', 'L'], ['T', 'B'], ['S', 'M']];
    
    ctx.fillStyle = colors[index];
    ctx.beginPath();
    ctx.arc(50, 50, 50, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 32px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(initials[index].join(''), 50, 50);
    
    avatar.src = canvas.toDataURL();
  });
}

// Download button functionality
document.querySelectorAll('.download-btn-hero, .download-btn').forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.preventDefault();
    
    // Add ripple effect
    const ripple = document.createElement('span');
    ripple.classList.add('ripple');
    this.appendChild(ripple);
    
    // Show download message
    const isApple = this.classList.contains('apple');
    const store = isApple ? 'App Store' : 'Google Play';
    
    // Create temporary message
    const message = document.createElement('div');
    message.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--text-dark);
      color: white;
      padding: 1rem 2rem;
      border-radius: var(--border-radius);
      z-index: 10000;
      font-weight: 600;
      box-shadow: var(--shadow);
    `;
    message.textContent = `Redirecting to ${store}...`;
    document.body.appendChild(message);
    
    // Remove message and ripple after animation
    setTimeout(() => {
      message.remove();
      ripple.remove();
    }, 2000);
  });
});

// Add ripple effect CSS
const style = document.createElement('style');
style.textContent = `
  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
  }
  
  @keyframes ripple {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);

// Keyboard navigation
document.addEventListener('keydown', function(e) {
  // Close modal with Escape key
  if (e.key === 'Escape' && modal.style.display === 'block') {
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
  }
  
  // Open modal with Enter key when How it Works button is focused
  if (e.key === 'Enter' && document.activeElement === howItWorksBtn) {
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';
  }
});

// Parallax effect for floating bricks
window.addEventListener('scroll', () => {
  const scrolled = window.pageYOffset;
  const parallax = document.querySelectorAll('.floating-brick');
  const speed = 0.5;

  parallax.forEach((element, index) => {
    const yPos = -(scrolled * speed * (index + 1) * 0.1);
    element.style.transform = `translateY(${yPos}px) rotate(${scrolled * 0.1}deg)`;
  });
});

// Performance optimization: Debounce scroll events
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// Apply debounced scroll handlers
const debouncedScroll = debounce(() => {
  // Any heavy scroll calculations can go here
}, 10);

window.addEventListener('scroll', debouncedScroll);

// Preload critical resources
window.addEventListener('load', () => {
  // Preload fonts
  const fontLink = document.createElement('link');
  fontLink.rel = 'preload';
  fontLink.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap';
  fontLink.as = 'style';
  document.head.appendChild(fontLink);
});

// Error handling for images
document.querySelectorAll('img').forEach(img => {
  img.addEventListener('error', function() {
    this.style.display = 'none';
  });
});

// Add loading states
window.addEventListener('load', () => {
  document.body.classList.add('loaded');
});

// Service Worker registration (for PWA capabilities)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // Only register if you have a service worker file
    // navigator.serviceWorker.register('/sw.js');
  });
}